# ุฅุตูุงุญ ุงูุชูุงูู ุงููุงูู ุจูู Cloud ู Edge Server

## ๐ ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. ุฅุถุงูุฉ ุงููุงููุฑุงุช ูุง ุชุนูู
**ุงููุดููุฉ:**
- ุนูุฏ ุฅุถุงูุฉ ูุงููุฑุง ุฌุฏูุฏุฉุ ูุง ูุชู ุฑุจุทูุง ุจุงูุณูุฑูุฑ ุงููุญูู
- ุงููุงููุฑุงุช ูุง ุชุธูุฑ ูู Edge Server
- ุงูููุฏูููุงุช ูุง ุชููุนูู ุจุดูู ุญูููู

**ุงูุญู:**
- ุชุญุณูู `EdgeServerService::syncCameraToEdge()` ูุถูุงู ุงูุงุชุตุงู ุงูุตุญูุญ
- ุฅุถุงูุฉ retry mechanism (ูุญุงููุชูู ูุน ุชุฃุฎูุฑ 100ms)
- ุฒูุงุฏุฉ timeout ุฅูู 10 ุซูุงู
- ุฅุถุงูุฉ error handling ุดุงูู
- ุชุญุฏูุซ ุญุงูุฉ ุงููุงููุฑุง (online/error) ุจูุงุกู ุนูู ูุชูุฌุฉ ุงูู sync
- ุฅุถุงูุฉ mapping ููููุฏูููุงุช ุจูู Cloud ู Edge Server

### 2. ุฅุถุงูุฉ ุงูุณูุฑูุฑุงุช ูุง ุชุนูู
**ุงููุดููุฉ:**
- ุนูุฏ ุฅุถุงูุฉ ุณูุฑูุฑ ุฌุฏูุฏุ ูุง ูุชู ุฑุจุทู ุจุดูู ุตุญูุญ
- `organization_id` ูุง ููุฑุณู ุชููุงุฆูุงู

**ุงูุญู:**
- ุชุนุฏูู `EdgeController::store()` ูุฅุถุงูุฉ `organization_id` ุชููุงุฆูุงู ูููุณุชุฎุฏููู ุบูุฑ Super Admin
- ุฅุถุงูุฉ validation ุฃูุถู
- ุฅุถุงูุฉ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ

### 3. ุงูููุฏูููุงุช ูุง ุชุนูู ุจุดูู ุญูููู
**ุงููุดููุฉ:**
- ุงูููุฏูููุงุช ุงูููุนููุฉ ูู Cloud ูุง ุชูุฑุณู ุฅูู Edge Server
- Edge Server ูุง ูุณุชูุจู ูุงุฆูุฉ ุงูููุฏูููุงุช ุจุดูู ุตุญูุญ

**ุงูุญู:**
- ุฅุถุงูุฉ module mapping ุจูู Cloud module IDs ู Edge Server module names:
  ```php
  'fire_detection' => 'fire',
  'face_recognition' => 'face',
  'vehicle_detection' => 'vehicle',
  'crowd_analysis' => 'crowd',
  'intrusion_detection' => 'intrusion',
  'loitering_detection' => 'loitering',
  'abandoned_object' => 'object',
  'people_counting' => 'counter',
  'license_plate' => 'vehicle',
  ```
- ุฅุฑุณุงู `enabled_modules` ูุน ูู ูุงููุฑุง ุฅูู Edge Server
- Edge Server ูุณุชูุจู ุงูููุฏูููุงุช ููููุนูููุง ูุนููุงู

### 4. ุงูุชูุงูู ุงููููู
**ุงููุดููุฉ:**
- ุงููุธุงู ูุนุฑุถ ุจูุงูุงุช ููููุฉ
- ูุง ููุฌุฏ ุงุชุตุงู ุญูููู ุจูู Cloud ู Edge Server

**ุงูุญู:**
- ุฅุตูุงุญ ุฌููุน endpoints ูู `EdgeServerService`
- ุฅุถุงูุฉ health check ูุจู sync
- ุฅุถุงูุฉ logging ุดุงูู ูุชุชุจุน ุงููุดุงูู
- ุฅุถุงูุฉ error handling ูู ุฌููุน ุงูุนูููุงุช

---

## ๐ ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### Backend (Laravel)

#### 1. `EdgeServerService.php`
- โ ุชุญุณูู `syncCameraToEdge()` ูุน retry ู error handling
- โ ุฅุถุงูุฉ module mapping
- โ ุชุญุณูู `getEdgeServerUrl()` ูุน logging
- โ ุฅุถุงูุฉ health check ูุจู sync
- โ ุชุญุฏูุซ ุญุงูุฉ ุงููุงููุฑุง ุจูุงุกู ุนูู ูุชูุฌุฉ sync

#### 2. `EdgeController.php`
- โ ุฅุตูุงุญ `store()` ูุฅุถุงูุฉ `organization_id` ุชููุงุฆูุงู
- โ ุชุญุณูู validation

#### 3. `CameraController.php`
- โ ุชุญุณูู error handling ูู `store()` ู `update()`
- โ ุฅุถุงูุฉ logging ุดุงูู
- โ ุงูุชุฃูุฏ ูู sync ุงููุงููุฑุง ุจุนุฏ ุงูุฅูุดุงุก/ุงูุชุญุฏูุซ

### Frontend (React)

#### 1. `Cameras.tsx`
- โ ุฅุถุงูุฉ validation ูุจู submit
- โ ุฅุถุงูุฉ ุฑุณุงุฆู ูุฌุงุญ/ุฎุทุฃ ูุงุถุญุฉ
- โ ุชุญุณูู error handling

#### 2. `Settings.tsx`
- โ ุฅุถุงูุฉ validation ูุจู submit
- โ ุฅุถุงูุฉ ุฑุณุงุฆู ูุฌุงุญ/ุฎุทุฃ
- โ ุนุฑุถ `edge_id` ุจุนุฏ ุฅุถุงูุฉ ุงูุณูุฑูุฑ

---

## ๐ Flow ุงูุชูุงูู ุงูุญูููู

### ุฅุถุงูุฉ ูุงููุฑุง ุฌุฏูุฏุฉ:
1. ุงููุณุชุฎุฏู ูููุฃ ุงููููุฐุฌ ูู Frontend
2. Frontend ูุฑุณู request ุฅูู `/api/v1/cameras` (POST)
3. Laravel ููุดุฆ ุงููุงููุฑุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. Laravel ูุณุชุฏุนู `EdgeServerService::syncCameraToEdge()`
5. Service ูุชุญูู ูู ุฃู Edge Server online
6. Service ูุฑุณู configuration ุฅูู Edge Server (`POST /api/v1/cameras`)
7. Edge Server ูุณุชูุจู ุงููุงููุฑุง ููููุนูููุง
8. Edge Server ูููุนูู ุงูููุฏูููุงุช ุงููุญุฏุฏุฉ
9. Laravel ููุญุฏูุซ ุญุงูุฉ ุงููุงููุฑุง (online/error)

### ุฅุถุงูุฉ ุณูุฑูุฑ ุฌุฏูุฏ:
1. ุงููุณุชุฎุฏู ูููุฃ ุงููููุฐุฌ ูู Frontend
2. Frontend ูุฑุณู request ุฅูู `/api/v1/edge-servers` (POST)
3. Laravel ูุถูู `organization_id` ุชููุงุฆูุงู
4. Laravel ููุดุฆ ุงูุณูุฑูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
5. Laravel ููุฑุฌุน `edge_id` ูููุณุชุฎุฏู
6. ุงููุณุชุฎุฏู ูุณุชุฎุฏู `edge_id` ูู Edge Server ููุฑุจุท

### ุชูุนูู ุงูููุฏูููุงุช:
1. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุงูููุฏูููุงุช ูู ูููุฐุฌ ุงููุงููุฑุง
2. Frontend ูุฑุณู `enabled_modules` array
3. Laravel ูุญูุธ ุงูููุฏูููุงุช ูู `config.enabled_modules`
4. ุนูุฏ syncุ Laravel ูุชุฑุฌู module IDs ุฅูู Edge Server module names
5. Edge Server ูุณุชูุจู ุงูููุฏูููุงุช ููููุนูููุง ูุนููุงู

---

## โ ุงูุชุญูู ูู ุงูุฅุตูุงุญุงุช

### 1. ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุงููุฑุง:
```bash
# 1. ุชุฃูุฏ ูู ุฃู Edge Server ูุนูู
curl http://192.168.1.100:8080/api/v1/health

# 2. ุฃุถู ูุงููุฑุง ูู Frontend
# 3. ุชุญูู ูู logs Laravel:
tail -f storage/logs/laravel.log | grep "Camera.*synced"

# 4. ุชุญูู ูู Edge Server:
curl http://192.168.1.100:8080/api/v1/cameras
```

### 2. ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุณูุฑูุฑ:
```bash
# 1. ุฃุถู ุณูุฑูุฑ ูู Frontend
# 2. ุชุญูู ูู ุฃู organization_id ุชู ุฅุถุงูุชู ุชููุงุฆูุงู
# 3. ุชุญูู ูู ุฃู edge_id ุชู ุฅูุดุงุคู
```

### 3. ุงุฎุชุจุงุฑ ุงูููุฏูููุงุช:
```bash
# 1. ุฃุถู ูุงููุฑุง ูุน ููุฏูููุงุช ููุนููุฉ
# 2. ุชุญูู ูู Edge Server logs:
# ูุฌุจ ุฃู ุชุฑู ุงูููุฏูููุงุช ููุนููุฉ ูู Edge Server
```

---

## ๐ Checklist

- [x] ุฅุตูุงุญ sync ุงููุงููุฑุงุช
- [x] ุฅุตูุงุญ ุฅุถุงูุฉ ุงูุณูุฑูุฑุงุช
- [x] ุฅุตูุงุญ ุชูุนูู ุงูููุฏูููุงุช
- [x] ุฅุถุงูุฉ error handling ุดุงูู
- [x] ุฅุถุงูุฉ logging
- [x] ุฅุถุงูุฉ validation ูู Frontend
- [x] ุฅุถุงูุฉ ุฑุณุงุฆู ูุฌุงุญ/ุฎุทุฃ
- [x] ุฅุถุงูุฉ module mapping
- [x] ุฅุถุงูุฉ health check
- [x] ุชุญุฏูุซ ุญุงูุฉ ุงููุงููุฑุงุช ุจูุงุกู ุนูู sync

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู ุนูู ุงูุณูุฑูุฑ

### 1. ุฑูุน ุงููููุงุช:
```bash
# Backend
cd /www/wwwroot/api.stcsolutions.online
git pull origin main

# Frontend
cd /path/to/web-portal
git pull origin main
npm run build
```

### 2. ูุณุญ Cache:
```bash
php artisan route:clear
php artisan config:clear
php artisan cache:clear
```

### 3. ุงูุชุญูู:
- โ ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุงููุฑุง
- โ ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุณูุฑูุฑ
- โ ุงุฎุชุจุงุฑ ุชูุนูู ุงูููุฏูููุงุช
- โ ุงูุชุญูู ูู logs

---

**ุงูุชุงุฑูุฎ:** 2 ููุงูุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 2.4.0

