# ğŸ› ï¸ Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªÙ†ØµÙŠØ¨ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø³Ø­Ø§Ø¨Ø© (Laravel) ÙˆØ§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ (Edge)

Ù‡Ø°Ø§ Ø§Ù„Ø¯Ù„ÙŠÙ„ ÙŠØ®ØªØµØ± Ø®Ø·ÙˆØ§Øª ØªØ¬Ù‡ÙŠØ² Ø®Ø§Ø¯Ù… Ø§Ù„Ù€VPS (Laravel: Ø¨Ø§Ùƒ Ø§Ù†Ø¯ + ÙˆØ§Ø¬Ù‡Ø© ÙˆÙŠØ¨) Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ (Edge) Ø§Ù„Ø°ÙŠ ÙŠØ´ØºÙ‘Ù„ Ø§Ù„Ù€AI ÙˆÙŠØ²Ø§Ù…Ù† Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ ÙÙ‚Ø·. Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¨Ø¹Ø¯ Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…ÙƒÙˆÙ†Ø§Øª ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©.

## ğŸ” Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©
- **Cloud Laravel (VPS):** Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù€API Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ù†Ø¸Ù…Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ²Ø¹ÙŠÙ† ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ø£ÙˆØ§Ù…Ø±. Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª PostgreSQL Ù…Ø¹ Ù…Ø®Ø·Ø· ÙˆØ¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¬Ø§Ù‡Ø²Ø© (`apps/cloud-laravel/database/schema.sql`).
- **Edge Server (Ù…Ø­Ù„ÙŠ):** FastAPI Ù„ØªØ´ØºÙŠÙ„ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù€AI ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„Ø§Øª ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ù…Ø­Ù„ÙŠÙ‹Ø§. ÙŠØ¨Ù‚Ù‰ ÙŠØ¹Ù…Ù„ Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ù…Ø¹ ÙØªØ±Ø© Ø³Ù…Ø§Ø­ ØªØ±Ø®ÙŠØµ 14 ÙŠÙˆÙ…Ù‹Ø§ ÙˆÙŠØ²Ø§Ù…Ù† Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ Ø¹Ù†Ø¯ ØªÙˆÙØ± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.

> Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ø³Ø®Ø© Ù†Ø¸ÙŠÙØ© ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªØºÙ„ÙŠÙ `scripts/package.sh` Ø«Ù… Ø£Ø®Ø° Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù…Ù† `dist/latest.zip`.

---

## â˜ï¸ Ù†Ø´Ø± Laravel Ø¹Ù„Ù‰ Ø§Ù„Ù€VPS
1) **Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª**
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y nginx php8.2 php8.2-fpm php8.2-pgsql php8.2-xml php8.2-zip php8.2-mbstring composer nodejs npm postgresql git
```

2) **Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**
```bash
sudo -u postgres createuser stc_cloud -P  # Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
sudo -u postgres createdb stc_cloud_db -O stc_cloud
```

3) **Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©**
```bash
cd /opt
sudo git clone https://github.com/your-org/STC-Solutions.git
sudo chown -R $USER:$USER STC-Solutions
cd STC-Solutions/apps/cloud-laravel
cp .env.example .env
# Ø¹Ø¯Ù‘Ù„ DB_HOST/DB_PORT/DB_DATABASE/DB_USERNAME/DB_PASSWORD Ùˆ MAIL_/FCM Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©
composer install --no-dev --optimize-autoloader
npm install && npm run build
php artisan key:generate
# Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø©
psql -U stc_cloud -d stc_cloud_db -f database/schema.sql
php artisan migrate --seed   # Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø¥Ø°Ø§ Ù„Ù… ØªØ³ØªÙˆØ±Ø¯ Ø§Ù„Ù…Ø®Ø·Ø·
```

4) **ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© (Production)**
- Ù…Ù„Ù Ø®Ø¯Ù…Ø© systemd `/etc/systemd/system/stc-cloud.service`:
```ini
[Unit]
Description=STC Cloud Laravel
After=network.target

[Service]
User=www-data
WorkingDirectory=/opt/STC-Solutions/apps/cloud-laravel
EnvironmentFile=/opt/STC-Solutions/apps/cloud-laravel/.env
ExecStart=/usr/bin/php /opt/STC-Solutions/apps/cloud-laravel/artisan serve --host=127.0.0.1 --port=8000
Restart=always

[Install]
WantedBy=multi-user.target
```
```bash
sudo systemctl daemon-reload
sudo systemctl enable --now stc-cloud
```

- Ø¥Ø¹Ø¯Ø§Ø¯ Nginx Ø¹ÙƒØ³ÙŠ (Ù…Ø«Ø§Ù„ `/etc/nginx/sites-available/stc-cloud`):
```nginx
server {
    listen 80;
    server_name your.domain.com;

    root /opt/STC-Solutions/apps/cloud-laravel/public;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;
    }
}
```
```bash
sudo ln -s /etc/nginx/sites-available/stc-cloud /etc/nginx/sites-enabled/stc-cloud
sudo nginx -t && sudo systemctl reload nginx
```

---

## ğŸ–¥ï¸ Ù†Ø´Ø± Edge (Ù…Ø­Ù„ÙŠ)
1) **Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª**
```bash
sudo apt install -y python3.11 python3.11-venv ffmpeg libgl1
```
2) **Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹**
```bash
cd /opt/STC-Solutions/apps/edge-server
python3.11 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
cp .env.example .env  # Ø¹ÙŠÙ‘Ù† CLOUD_API_URL Ùˆ LICENSE_KEY ÙˆØ¨Ù‚ÙŠØ© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
```
3) **ØªØ´ØºÙŠÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ**
```bash
uvicorn main:app --host 0.0.0.0 --port 8080
```
4) **Ø¨Ù†Ø§Ø¡ EXE (Ø¹Ù„Ù‰ Ø¨ÙŠØ¦Ø© ÙˆÙŠÙ†Ø¯ÙˆØ² Ø£Ùˆ cross-build)**
```bash
./scripts/build_installer.sh
# Ø³ÙŠÙÙ†Ø´Ø¦ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ ØªØ­Øª dist/
```

---

## ğŸ”— Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
- Edge ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±Ø®ÙŠØµ Ø¹Ø¨Ø± Laravel: `POST /api/license/validate` (ÙŠØ·Ø¨Ù‚ ÙØªØ±Ø© Ø§Ù„Ø³Ù…Ø§Ø­ 14 ÙŠÙˆÙ…Ù‹Ø§ ÙˆÙŠØ­ÙØ¸Ù‡Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§).
- Ù†Ø¨Ø¶Ø§Øª Ø§Ù„ØµØ­Ø©: `POST /api/edges/heartbeat` Ù…Ø¹ `hardware_id` Ùˆ`version` Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©.
- Ø±ÙØ¹ Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ ÙÙ‚Ø· (Ø¯ÙˆÙ† ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆ): `POST /api/edges/events`.
- Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©: `GET /api/edges/{hardware_id}/commands` Ø«Ù… `POST /api/edges/commands/{id}/ack` Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°.

## âœ… Ù‚Ø§Ø¦Ù…Ø© ØªØ­Ù‚Ù‚ Ø³Ø±ÙŠØ¹Ø©
- Ø§Ø³ØªÙˆØ±Ø¯Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© (Ø£Ùˆ Ø´ØºÙ„Øª `migrate --seed`).
- Ù…Ù„Ù `.env` ÙÙŠ Laravel ÙŠØ­ØªÙˆÙŠ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø¨Ø±ÙŠØ¯/Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (FCM) ÙˆØ¨ÙŠØ§Ù†Ø§Øª DB.
- Ù…Ù„Ù `.env` ÙÙŠ Edge ÙŠØ­ØªÙˆÙŠ `CLOUD_API_URL` Ùˆ`LICENSE_KEY` ÙˆÙ…Ø³Ø§Ø±Ø§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª/Ø§Ù„ØªÙƒØ§Ù…Ù„Ø§Øª.
- Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙˆÙŠØ¨ Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙˆØ§Ø®ØªØ¨Ø§Ø± API Ø§Ù„ØªØ±Ø®ÙŠØµ Ù…Ù† Edge Ø¨Ù†Ø¬Ø§Ø­.
- Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ØªØ¸Ù‡Ø± ÙÙŠ Ø¬Ø¯Ø§ÙˆÙ„ Laravel Ø¨Ø¯ÙˆÙ† Ø£Ø¹Ø·Ø§Ù„.
