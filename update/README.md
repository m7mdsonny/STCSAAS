<div dir="rtl">

# ๐ง ุชุญุฏูุซ ุงููุตุงุฏูุฉ - Laravel Sanctum

**ุงูุชุงุฑูุฎ:** 2025-12-17
**ุงููุดููุฉ:** ุนุฏู ุนูู ูุธุงู ุงููุตุงุฏูุฉ ุจูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุงูุฎุงุฏู
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ

---

## ๐ ููุฎุต ุงูุชุญุฏูุซ

ุชู ุฅุตูุงุญ ุชูุงูู ุงููุตุงุฏูุฉ ุจูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (React) ูุงูุฎุงุฏู ุงูุฎููู (Laravel) ูู ุฎูุงู ูุทุงุจูุฉ ูุณุงุฑุงุช API ูุฅุถุงูุฉ ุงูููุงุท ุงูููุงุฆูุฉ ุงูููููุฏุฉ.

---

## โ ุชุฃููุฏ ุงูุชูุงูู

### 1. ุงูุชูุงูู ูุน /api/v1

โ **ุชุทุจูู ุงูููุจุงูู:** ูุณุชุฎุฏู ุจุงููุนู `/api/v1`
```dart
// apps/mobile-app/lib/config/env.dart
defaultValue: 'http://localhost:8000/api/v1'
```

โ **ุฎุงุฏู Edge:** ูุณุชุฎุฏู ุจุงููุนู `/api/v1` ูุฌููุน ุงููุณุงุฑุงุช
```python
# ุฌููุน ุงููุณุงุฑุงุช ุชุณุชุฎุฏู /api/v1/edge/*
app.include_router(routes.router, prefix="/api/v1")
```

โ **ุงูุจูุงุจุฉ ุงูุฅููุชุฑูููุฉ:** ุชู ุชุญุฏูุซูุง ูุงุณุชุฎุฏุงู `/api/v1`

**ุงููุชูุฌุฉ:** ุฌููุน ุงูุนููุงุก ูุชูุงูููู - ูุง ุชูุฌุฏ ุชุบููุฑุงุช ูุทููุจุฉ ุนูู Mobile ุฃู Edge Server

---

### 2. ูุทุงู ุงูููุฒุงุช

โ **ูู ูุชู ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ**
- ุชู ููุท ุฅุถุงูุฉ ููุงุท ุงูููุงูุฉ ุงูุชู ูุงูุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุชุณุชุฏุนููุง ุจุงููุนู
- `register` - ุงูุชุณุฌูู (ูุงูุช ุงููุงุฌูุฉ ุชุญุงูู ุงุณุชุฏุนุงุกู)
- `updateProfile` - ุชุญุฏูุซ ุงูููู ุงูุดุฎุตู (ูุงูุช ุงููุงุฌูุฉ ุชุญุงูู ุงุณุชุฏุนุงุกู)
- `changePassword` - ุชุบููุฑ ูููุฉ ุงููุฑูุฑ (ูุงูุช ุงููุงุฌูุฉ ุชุญุงูู ุงุณุชุฏุนุงุกู)

โ **ูู ูุชู ุชุบููุฑ ุงููููู ุงููุนูุงุฑู**
- ููุณ Laravel Sanctum
- ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช PostgreSQL
- ูุง ููุฌุฏ Supabase
- ูุง ุชูุฌุฏ ุชุจุนูุงุช ุฌุฏูุฏุฉ

---

## ๐ฆ ุงููููุงุช ุงููุนุฏูุฉ

### 1. apps/cloud-laravel/routes/api.php
**ุงูุญุงูุฉ:** ูุนุฏู (ุฅูุฒุงูู)

**ุงูุชุบููุฑุงุช:**
```php
// ูุจู: ุงููุณุงุฑุงุช ูู /api/auth/*
Route::post('/auth/login', ...);

// ุจุนุฏ: ุงููุณุงุฑุงุช ูู /api/v1/auth/*
Route::prefix('v1')->group(function () {
    Route::post('/auth/login', ...);
    Route::post('/auth/register', ...);      // ุฌุฏูุฏ
    Route::get('/auth/me', ...);             // ุชู ุงูููู
    Route::put('/auth/profile', ...);        // ุฌุฏูุฏ
    Route::put('/auth/password', ...);       // ุฌุฏูุฏ
});
```

**ุงูููุงุฆุฏ:**
- ูุทุงุจูุฉ ุชููุนุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
- ุชูุงูู ูุน Mobile ู Edge Server
- ุจููุฉ ููุธูุฉ ูููุณุงุฑุงุช

---

### 2. apps/cloud-laravel/app/Http/Controllers/AuthController.php
**ุงูุญุงูุฉ:** ูุนุฏู (ุฅูุฒุงูู)

**ุงูุชุบููุฑุงุช:**

#### ุชู ุฅุถุงูุฉ ุฏุงูุฉ `register()`:
```php
public function register(Request $request): JsonResponse
{
    // ุงูุชุญูู ูู: ุงูุงุณูุ ุงูุจุฑูุฏุ ูููุฉ ุงููุฑูุฑุ ุงููุงุชู
    // ุฅูุดุงุก ุงููุณุชุฎุฏู ูุน ุชุดููุฑ ูููุฉ ุงููุฑูุฑ
    // ุฅุฑุฌุงุน: ุงูุชููู ูุงููุณุชุฎุฏู
}
```

#### ุชู ุฅุถุงูุฉ ุฏุงูุฉ `updateProfile()`:
```php
public function updateProfile(Request $request): JsonResponse
{
    // ุชุญุฏูุซ: ุงูุงุณูุ ุงููุงุชูุ ุงูุตูุฑุฉ
    // ุฅุฑุฌุงุน: ุจูุงูุงุช ุงููุณุชุฎุฏู ุงููุญุฏุซุฉ
}
```

#### ุชู ุฅุถุงูุฉ ุฏุงูุฉ `changePassword()`:
```php
public function changePassword(Request $request): JsonResponse
{
    // ุงูุชุญูู ูู ูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ
    // ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ ูุน ุงูุชุดููุฑ
    // ุฅุฑุฌุงุน: ุฑุณุงูุฉ ูุฌุงุญ
}
```

---

### 3. apps/web-portal/.env
**ุงูุญุงูุฉ:** ููู ุฌุฏูุฏ (ุฅูุฒุงูู)

**ุงููุญุชูู:**
```env
# ุนููุงู API ุงูุฎุงุต ุจู Laravel (ุนุฏูู ุญุณุจ ุงูุฎุงุฏู)
VITE_API_URL=http://localhost:8000/api/v1
```

**ููุงุญุธุฉ ูููุฉ:**
- ูู ุงูุชุทููุฑ: `http://localhost:8000/api/v1`
- ูู ุงูุฅูุชุงุฌ: `https://your-domain.com/api/v1`

---

## ๐ ุฎุทูุงุช ุงูุฑูุน ูุงูุชูุตูุจ

### ุงูุฎุทูุฉ 1: ูุณุฎ ุงููููุงุช ุงููุนุฏูุฉ

ูู ูุฌูุฏ ุงููุดุฑูุน ุงูุฑุฆูุณู:

```bash
# ูุณุฎ ููู ุงููุณุงุฑุงุช
cp update/apps/cloud-laravel/routes/api.php \
   apps/cloud-laravel/routes/api.php

# ูุณุฎ ุงููุชุญูู
cp update/apps/cloud-laravel/app/Http/Controllers/AuthController.php \
   apps/cloud-laravel/app/Http/Controllers/AuthController.php

# ูุณุฎ ุฅุนุฏุงุฏุงุช ุงููุงุฌูุฉ
cp update/apps/web-portal/.env \
   apps/web-portal/.env
```

---

### ุงูุฎุทูุฉ 2: ุชุนุฏูู VITE_API_URL (ุฅุฐุง ูุฒู ุงูุฃูุฑ)

ุฅุฐุง ูุงู ุฎุงุฏู Laravel ูุนูู ุนูู ุนููุงู ูุฎุชูู:

```bash
cd apps/web-portal
nano .env

# ุนุฏู ุงูุณุทุฑ:
VITE_API_URL=http://your-laravel-server:8000/api/v1
```

---

### ุงูุฎุทูุฉ 3: ุชูุธูู ุงููุงุด ูู Laravel

```bash
cd apps/cloud-laravel

# ุชูุธูู ุงููุณุงุฑุงุช
php artisan route:clear

# ุชูุธูู ุงูุฅุนุฏุงุฏุงุช
php artisan config:clear

# ุชูุธูู ุงููุงุด
php artisan cache:clear
```

---

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงููุณุงุฑุงุช

```bash
cd apps/cloud-laravel

# ุนุฑุถ ุฌููุน ูุณุงุฑุงุช ุงููุตุงุฏูุฉ
php artisan route:list | grep auth
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
POST   /api/v1/auth/login
POST   /api/v1/auth/register
POST   /api/v1/auth/logout
GET    /api/v1/auth/me
PUT    /api/v1/auth/profile
PUT    /api/v1/auth/password
```

---

### ุงูุฎุทูุฉ 5: ุชุดุบูู ุฎุงุฏู Laravel

```bash
cd apps/cloud-laravel

# ุชุดุบูู ุงูุฎุงุฏู
php artisan serve --host 0.0.0.0 --port 8000
```

ุงูุฎุงุฏู ุงูุขู ูุนูู ุนูู: `http://localhost:8000`

---

### ุงูุฎุทูุฉ 6: ุชุดุบูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

ูู ูุงูุฐุฉ ุทุฑููุฉ ุฌุฏูุฏุฉ:

```bash
cd apps/web-portal

# ุชุซุจูุช ุงูุงุนุชูุงุฏูุงุช (ุฅุฐุง ูู ูุชู)
npm install

# ุชุดุบูู ุฎุงุฏู ุงูุชุทููุฑ
npm run dev
```

ุงููุงุฌูุฉ ุงูุขู ุชุนูู ุนูู: `http://localhost:5173`

---

## โ ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ุงูุชุณุฌูู

1. ุงูุชุญ ุงููุชุตูุญ: `http://localhost:5173/login`
2. ุงุถุบุท ุนูู ุฒุฑ "Super Admin" ุฃู "Org Owner"
3. ุณูุชู ููุก ุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ ุชููุงุฆููุง
4. ุงุถุบุท "ุชุณุฌูู ุงูุฏุฎูู"

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงูุญุตูู ุนูู ุชููู
- ุงูุชูุฌู ุฅูู ููุญุฉ ุงูุชุญูู

---

### 2. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู

ุงุณุชุฎุฏู ุจูุงูุงุช ุงูุฏุฎูู:
- ุงูุจุฑูุฏ: `admin@stc-demo.com`
- ูููุฉ ุงููุฑูุฑ: `Admin@123`

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุงุณุชุฌุงุจุฉ HTTP 200
- ุงูุญุตูู ุนูู ุชููู
- ุญูุธ ุงูุชููู ูู localStorage
- ุงูุชูุฌู ุฅูู ููุญุฉ ุงูุชุญูู ุงูููุงุณุจุฉ

---

### 3. ุงุฎุชุจุงุฑ ุงุณุชูุฑุงุฑ ุงูุฌูุณุฉ

1. ุณุฌู ุฏุฎูู ุจูุฌุงุญ
2. ูู ุจุชุญุฏูุซ ุงูุตูุญุฉ (F5)
3. ูุฌุจ ุฃู ุชุจูู ูุณุฌู ุฏุฎูู
4. ูุง ูุชู ุงูุชูุฌู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

---

### 4. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ

1. ุงุถุบุท ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
2. ูุชู ุงูุชูุฌู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
3. ุฅุฒุงูุฉ ุงูุชููู ูู localStorage
4. ุนูุฏ ุงูุชุญุฏูุซ ุชุจูู ูุณุฌู ุฎุฑูุฌ

---

### 5. ุงูุชุญูู ูู ุงูุณุฌูุงุช

ุฑุงูุจ ุณุฌูุงุช Laravel:

```bash
cd apps/cloud-laravel
tail -f storage/logs/laravel.log
```

ุชุฃูุฏ ูู:
- ุฌููุน ุงูุทูุจุงุช ุชุฐูุจ ูููุณุงุฑุงุช ุงูุตุญูุญุฉ
- ูุฌูุฏ ุฑุคูุณ ุงููุตุงุฏูุฉ
- ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก 404
- ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก CORS

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุฎุทุฃ "Network error" ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุดุบูู ุฎุงุฏู Laravel: `curl http://localhost:8000/api/v1/auth/login`
2. ุชุญูู ูู `VITE_API_URL` ูู `apps/web-portal/.env`
3. ุฑุงุฌุน console ูู ุงููุชุตูุญ ูุฃุฎุทุงุก CORS
4. ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช CORS ูู Laravel

---

### ุงููุดููุฉ: ุฎุทุฃ 404 ุนูู /api/v1/auth/login

**ุงูุญู:**
1. ุชุญูู ูู ููู ุงููุณุงุฑุงุช: `php artisan route:list | grep auth`
2. ูุฌุจ ุฃู ุชุฑู:
   ```
   POST /api/v1/auth/login
   POST /api/v1/auth/register
   GET /api/v1/auth/me
   ```
3. ูุธู ูุงุด ุงููุณุงุฑุงุช: `php artisan route:clear`
4. ุฃุนุฏ ุชุดุบูู ุฎุงุฏู Laravel

---

### ุงููุดููุฉ: ุฎุทุฃ 401 ุนูู /auth/me

**ุงูุญู:**
1. ุชุญูู ูู ุงูุชููู ูู localStorage: `localStorage.getItem('auth_token')`
2. ุชุฃูุฏ ูู ุตูุบุฉ ุงูุชููู: ูุฌุจ ุฃู ูููู `1|xxxxxxxxxxxx`
3. ุฑุงุฌุน ุณุฌูุงุช Laravel ูุฃุฎุทุงุก ุงูุชุญูู
4. ูุฏ ูููู ุงูุชููู ููุชูู - ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู

---

### ุงููุดููุฉ: ุฃุฎุทุงุก CORS ูู ุงููุชุตูุญ

**ุงูุญู:**
1. ุฑุงุฌุน `apps/cloud-laravel/config/cors.php`
2. ุชุฃูุฏ ูู ุฃู `allowed_origins` ูุชุถูู ุนููุงู ุงููุงุฌูุฉ
3. ุฃุถู ุนููุงู ุงููุงุฌูุฉ ุฅุฐุง ูุฒู:
   ```php
   'allowed_origins' => ['http://localhost:5173'],
   ```
4. ุฃุนุฏ ุชุดุบูู ุฎุงุฏู Laravel

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

| ุงูุนูุตุฑ | ูุจู | ุจุนุฏ |
|--------|-----|-----|
| ุจุงุฏุฆุฉ API | โ `/api/auth/login` | โ `/api/v1/auth/login` |
| ููุทุฉ ุงูุชุณุฌูู | โ ููููุฏุฉ | โ POST `/api/v1/auth/register` |
| ููุทุฉ ุงูููู ุงูุดุฎุตู | โ `/api/me` | โ GET `/api/v1/auth/me` |
| ุชุญุฏูุซ ุงูููู | โ ููููุฏุฉ | โ PUT `/api/v1/auth/profile` |
| ุชุบููุฑ ูููุฉ ุงููุฑูุฑ | โ ููููุฏุฉ | โ PUT `/api/v1/auth/password` |
| ุนููุงู API | โ ุบูุฑ ูุนุฑู | โ ูุงุจู ููุชุนุฏูู ุนุจุฑ .env |
| ุชุฏูู ุงููุตุงุฏูุฉ | โ ูุนุทู | โ ูุนูู ุจุงููุงูู |
| ุฅุฏุงุฑุฉ ุงูุฌูุณุฉ | โ ุบูุฑ ูุญููุธุฉ | โ ูุญููุธุฉ ูู localStorage |

---

## ๐๏ธ ุงููููู ุงููุนูุงุฑู

### ุชุฏูู ุชุณุฌูู ุงูุฏุฎูู:
```
1. ุงููุณุชุฎุฏู ูุฏุฎู ุจูุงูุงุช ุงูุฏุฎูู
2. ุงููุงุฌูุฉ ุชุฑุณู POST /api/v1/auth/login
3. Laravel ูุชุญูู ูู ุงูุจูุงูุงุช
4. Laravel ูููุฏ ุชููู Sanctum
5. ุงููุงุฌูุฉ ุชุญูุธ ุงูุชููู ูู localStorage
6. ุฌููุน ุงูุทูุจุงุช ุชุชุถูู Authorization: Bearer {token}
7. Laravel ูุชุญูู ูู ุงูุชููู ุนุจุฑ Sanctum
```

### ุชุฏูู ุงูุชุณุฌูู:
```
1. ุงููุณุชุฎุฏู ูููุฃ ูููุฐุฌ ุงูุชุณุฌูู
2. ุงููุงุฌูุฉ ุชุฑุณู POST /api/v1/auth/register
3. Laravel ูุชุญูู ูููุดุฆ ุงููุณุชุฎุฏู
4. Laravel ูููุฏ ุชููู Sanctum
5. ุงููุงุฌูุฉ ุชุญูุธ ุงูุชููู ูุชูุฌู ูููุญุฉ ุงูุชุญูู
```

### ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- ุฌุฏูู `users` ูุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏููู
- ุฌุฏูู `personal_access_tokens` ูุญูุธ ุชูููุงุช Sanctum
- ูุง ููุฌุฏ ุงุชุตุงู ุจู Supabase
- ุฌููุน ุงููุตุงุฏูุฉ ุนุจุฑ Laravel

---

## ๐ ููุงุญุธุงุช ุฃูููุฉ

1. **ุชุดููุฑ ูููุงุช ุงููุฑูุฑ:** ุฌููุน ูููุงุช ุงููุฑูุฑ ูุดูุฑุฉ ุจู bcrypt
2. **ุงููุตุงุฏูุฉ ุจุงูุชููู:** ูุตุงุฏูุฉ stateless ุนุจุฑ Sanctum
3. **HTTPS ูุทููุจ:** ุงุณุชุฎุฏู HTTPS ูู ุงูุฅูุชุงุฌ
4. **CORS ูุนุฏ:** ููุท ุงูุฃุตูู ุงููุณููุญุฉ ูููููุง ุงููุตูู ููู API
5. **ุงูุชูุงุก ุงูุชููู:** ุงูุชูููุงุช ูุง ุชูุชูู ุงูุชุฑุงุถููุง (ูููุตุญ ุจุฅุถุงูุฉ ุงูุชูุงุก)
6. **ุชุญุฏูุฏ ุงููุนุฏู:** ูููุตุญ ุจุฅุถุงูุฉ rate limiting ูููุงุท ุงููุตุงุฏูุฉ
7. **ุงูุชุญูู ูู ุงููุฏุฎูุงุช:** ุฌููุน ุงููุฏุฎูุงุช ูุชู ุงูุชุญูู ูููุง ูุจู ุงููุนุงูุฌุฉ

---

## โ ูุงุฆูุฉ ุงููุญุต ุงูููุงุฆูุฉ

- [ ] ุฎุงุฏู Laravel ูุนูู ุจุฏูู ุฃุฎุทุงุก
- [ ] ุงููุงุฌูุฉ ุชูุจูู ุจูุฌุงุญ
- [ ] ูููู ุฅูุดุงุก ุญุณุงุจุงุช ุชุฌุฑูุจูุฉ
- [ ] ูููู ุชุณุฌูู ุงูุฏุฎูู ุจุจูุงูุงุช ุงูุญุณุงุจ
- [ ] ุงูุชููู ูุธูุฑ ูู localStorage
- [ ] ูููู ุงููุตูู ูููุญุฉ ุงูุชุญูู ุจุนุฏ ุงูุฏุฎูู
- [ ] ุงูุฌูุณุฉ ุชุณุชูุฑ ุนูุฏ ุชุญุฏูุซ ุงูุตูุญุฉ
- [ ] ูููู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ
- [ ] ุงูุชููู ููุฒุงู ุจุนุฏ ุงูุฎุฑูุฌ
- [ ] ุฎุทุฃ 401 ููุฌู ูุตูุญุฉ ุงูุฏุฎูู
- [ ] ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู console
- [ ] ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงูุดุจูุฉ

---

## ๐ ุงูุฏุนู ุงูููู

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุช:
1. ุฑุงุฌุน ูุณู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ุฃุนูุงู
2. ุชุญูู ูู ุณุฌูุงุช Laravel
3. ุฑุงุฌุน console ุงููุชุตูุญ ููุฃุฎุทุงุก
4. ุชุฃูุฏ ูู ูุณุฎ ุฌููุน ุงููููุงุช ุจุดูู ุตุญูุญ

---

## ๐ฏ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

โ ุฌููุน ุงูุนููุงุก ูุชูุงูููู ูุน `/api/v1`
โ ูู ูุชู ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ
โ ููุณ ุงููููู ุงููุนูุงุฑู (Laravel Sanctum)
โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงููุดุฑ

**ุงููููู ุงููุนูุงุฑู:** Laravel Sanctum (Backend) โ React SPA (Frontend)
**ูุง ููุฌุฏ Supabase:** ูุตุงุฏูุฉ Laravel ูููุฉ
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู

---

</div>
